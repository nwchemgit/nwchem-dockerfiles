services:
  nwchem:
    container_name: nwchem
#    image: "ghcr.io/nwchemgit/nwchem-dev.openmpi.mpi-pr:latest"
    image: "ghcr.io/nwchemgit/nwchem-dev.mpi-pr:latest"
    volumes:
       - $PWD:/data
      #- .:/data
    privileged: false
    network_mode: host
    shm_size: 2048000000 #2GB
#    pull_policy: always
    environment:
       - OMP_NUM_THREADS=${OMP_NUM_THREADS:-1}
       - HWLOC_COMPONENTS=-gl
       - OMPI_ALLOW_RUN_AS_ROOT=1
       - OMPI_ALLOW_RUN_AS_ROOT_CONFIRM=1
    entrypoint:
      - "mpirun"
      - "-np"
      - "${MYNPROC:-3}"
      - "nwchem"
